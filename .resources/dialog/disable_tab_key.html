<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>disable_tab_key</title>
<!--
【测试目的】
在需要时，禁止使用 tab 键在交互元素之间切换。

【测试环境】
IE6
IE7
IE8
IE9
Firefox 6.0.2
Chrome 14.0.835.186 m
Safari 5.1.1 (7534.51.22)
Opera 11.51

【测试结果】

-->
<style>
#dialog { display: none; width: 400px; height: 300px; border: 1px solid #000; background: #888; }
#first, #before, #after {
  position: absolute;
  left: -10000px;
}
</style>
<script src="../../import.js"></script>
</head>
<body>
<input id="first" type="text">
<fieldset>
  <legend>对话框出现时，对话框外的部分不能使用 tab 键导航，对话框隐藏时才可以。</legend>
  <input type="button" value="button">
  <input type="text" value="text">
  <input type="text" value="text">
  <a href="#">a</a>
</fieldset>

<button type="button" onclick="dialog.open();">打开对话框</button>

<div id="dialog">
  <input id="before" type="text">
  <button type="button" onclick="dialog.close();">关闭对话框</button>
  <fieldset>
    <legend>对话框出现时，仅对话框内的部分可以使用 tab 键导航。</legend>
    <input type="button" value="button">
    <input type="text" value="text">
    <input type="text" value="text">
    <a href="#">a</a>
  </fieldset>
  <input id="after" type="text">
</div>
<script>
/*
 function getInteractiveChild($element) {
 var tags = ['A', 'BUTTON', 'INPUT', 'SELECT', 'TEXTAREA', 'LABEL'];
 var tag = null;
 while (tag = tags.shift()) {
 var children = $element.getElementsByTagName(tag);
 for (var i = 0, l = children.length; i < l; i++) {
 var child = children[i];
 if (child.offsetWidth && child.offsetHeight) {
 return child;
 }
 }
 }
 return null;
 }
 */

var $dialog = $('#dialog');
var $first = document.getElementById('first');
var $before = document.getElementById('before');
var $after = document.getElementById('after');
var dialog = {
  open: function() {
    $dialog.style.display = 'block';
    $first.focus();
  },
  close: function() {
    $dialog.style.display = 'none';
  }
};
$first.onfocus = function() {
  if ($before.offsetWidth) {
    $before.focus();
  }
};

$before.onkeypress = $before.onkeydown = function(e) {  // TODO: 只有 Opera 需要 keypress。
  e = e || window.event;
  if (e.keyCode === 9 && e.shiftKey) {
    $after.focus();
    e.preventDefault ? e.preventDefault() : e.returnValue = false;
  }
  console.log(e)
};
$after.onkeypress = $after.onkeydown = function(e) {
  e = e || window.event;
  if (e.keyCode === 9 && !e.shiftKey) {
    $before.focus();
    e.preventDefault ? e.preventDefault() : e.returnValue = false;
  }
};

document.preloadImages('/header_bg.png', '/footer_logo.png', '/menu_current.png');
// freezFocusArea unfreezFocusArea
//$(document.body).on('focusin', function(e) {
//  var $target = e.target;
//  if(!$dialog.isAncestorOf($target)){
//    setTimeout(function(){$before.focus();}, 0);
//  }
//
//
//  console.log(e.target);
//
//});
</script>
</body>
</html>
