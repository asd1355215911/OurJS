<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>远程请求</title>
<script src="../../our.js"></script>
<script src="../../scripts/framework.js"></script>
<script src="../../src/utilities/logger.js"></script>
<style>
blockquote { margin: 5px 0 0; padding: 5px; border: 1px solid gainsboro; }
</style>
</head>
<body>
<div id="content">
  <h1>远程请求</h1>

  <h2>Request</h2>
  <fieldset>
    <legend>使用 Request 进行同域请求</legend>
    <div id="logger" style="height: 200px;"></div>
    <blockquote>
      <button id="send_txt">send (data.txt) x 3 times</button>
      <br>
      <button id="send_xml">send (data.xml)</button>
      <button id="abort_xml">abort (data.xml)</button>
    </blockquote>
  </fieldset>
  <script>
  (function() {
    var logger = new Logger($('#logger'), true);

    var times = 1;
    var requestTXT = new Request('data.txt', {useCache: false})
        .on('send', function(e) {
          logger.log('<em>' + e.type + '</em>' + e.data);
        })
        .on('complete', function(e) {
          logger.log('<strong>' + e.type + '</strong>status=<var>' + e.status + '</var> statusText=<var>' + e.statusText + '</var> text=<var>' + e.text + '</var>');
        })
        .on('complete', function(e) {
          if (times++ < 3) {
            this.send({times: times});
            if (times === 2) {
              this.abort();
            }
          } else {
            times = 1;
          }
        });
    $('#send_txt').on('click', function() {
      requestTXT.send({times: 1});
    });

    var requestXML = new Request('data.xml', {minTime: 500})
        .on('send, success, abort, timeout', function(e) {
          logger.log('<em>' + e.type + '</em>');
        })
        .on('complete', function(e) {
          logger.log('<strong>' + e.type + '</strong>status=<var>' + e.status + '</var> statusText=<var>' + e.statusText + '</var>' + (e.xml ? ' nodeName=<var>' + e.xml.documentElement.nodeName + '</var>' : ''));
        });
    $('#send_xml').on('click', function() {
      requestXML.send();
    });
    $('#abort_xml').on('click', function() {
      requestXML.abort();
    });

  })();
  </script>

  <h2>JSONP</h2>
  <fieldset>
    <legend>使用 JSONP 模式进行跨域请求</legend>
    <div id="logger_jsonprequest" style="height: 200px;"></div>
    <blockquote>
      <button id="send">send</button>
      <button id="abort">abort</button>
    </blockquote>
  </fieldset>
  <script>
  (function() {
    var logger = new Logger($('#logger_jsonprequest'), true);

    var getList = new Request('http://www.highcharts.com/samples/data/jsonp.php', {
      mode: 'jsonp',
      minTime: 2000,
      maxTime: 5000
    })
        .on('send, success, abort, timeout', function(e) {
          logger.log('<em>' + e.type + '</em>' + (e.data ? e.data.length : null));
        })
        .on('complete', function(e) {
          logger.log('<strong>' + e.type + '</strong>' + (e.data ? e.data.length : null));
        });

    $('#send').on('click', function() {
      getList.send('filename=aapl-c.json');
    });
    $('#abort').on('click', function() {
      getList.abort();
    });

  })();
  </script>

</div>
</body>
</html>
