<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>远程请求</title>
<script src="../../our.js"></script>
<script src="../../scripts/common_loader.js"></script>
<script src="../../scripts/widget-logger.js"></script>
<style>
blockquote { margin: 5px 0 0; padding: 5px; border: 1px solid gainsboro; }
</style>
</head>
<body>
<div id="content">
  <h1>远程请求</h1>

  <h2>Request</h2>
  <fieldset>
    <legend>使用 Request 进行同域请求</legend>
    <div id="logger_xhr" class="widget-logger" style="height: 200px;" data-clearable></div>
    <blockquote>
      <button id="send_txt">send (data.txt)</button>
      <button id="send_abort_txt">send and abort (data.txt)</button>
      <br>
      <button id="send_xml">send (data.xml)</button>
      <button id="abort_xml">abort (data.xml)</button>
    </blockquote>
  </fieldset>
  <script>
  document.on('domready', function() {
    var $logger = $('#logger_xhr');

    var getTXT = new Request('data.txt', {useCache: false})
        .on('start', function(e) {
          $logger.log('<strong>' + e.type + '</strong>data=<var>' + e.data + '</var>');
        })
        .on('abort, timeout, complete', function(e) {
          $logger.log('<em>' + e.type + '</em>');
        })
        .on('finish', function(e) {
          $logger.log('<strong>' + e.type + '</strong>status=<var>' + e.status + '</var> statusText=<var>' + e.statusText + '</var> text=<var>' + e.text + '</var>');
        });
    $('#send_txt').on('click', function() {
      getTXT.send({type: 'Normal.'});
    });
    $('#send_abort_txt').on('click', function() {
      getTXT.send({type: 'Call abort method immediately.'});
      getTXT.abort();
    });

    var getXML = new Request('data.xml', {minTime: 500})
        .on('start', function(e) {
          $logger.log('<strong>' + e.type + '</strong>data=<var>' + e.data + '</var>');
        })
        .on('abort, timeout, complete', function(e) {
          $logger.log('<em>' + e.type + '</em>');
        })
        .on('finish', function(e) {
          $logger.log('<strong>' + e.type + '</strong>status=<var>' + e.status + '</var> statusText=<var>' + e.statusText + '</var>' + (e.xml ? ' nodeName=<var>' + e.xml.documentElement.nodeName + '</var>' : ''));
        });
    $('#send_xml').on('click', function() {
      getXML.send();
    });
    $('#abort_xml').on('click', function() {
      getXML.abort();
    });

  });
  </script>

  <h2>JSONP</h2>
  <fieldset>
    <legend>使用 JSONP 模式进行跨域请求</legend>
    <div id="logger_jsonp" class="widget-logger" style="height: 200px;" data-clearable></div>
    <blockquote>
      <button id="send_jsonp">send</button>
      <button id="abort_jsonp">abort</button>
    </blockquote>
  </fieldset>
  <script>
  document.on('domready', function() {
    var $logger = $('#logger_jsonp');

    var getList = new Request('http://www.highcharts.com/samples/data/jsonp.php', {
      mode: 'jsonp',
      minTime: 2000,
      maxTime: 5000
    })
        .on('start', function(e) {
          $logger.log('<strong>' + e.type + '</strong>data=<var>' + e.data + '</var>');
        })
        .on('abort, timeout, complete', function(e) {
          $logger.log('<em>' + e.type + '</em>');
        })
        .on('finish', function(e) {
          $logger.log('<strong>' + e.type + '</strong>' + (e.data ? 'data.length=<var>' + e.data.length + '</var>' : ''));
        });

    $('#send_jsonp').on('click', function() {
      getList.send({filename: 'aapl-c.json'});
    });
    $('#abort_jsonp').on('click', function() {
      getList.abort();
    });

  });
  </script>

</div>
</body>
</html>
