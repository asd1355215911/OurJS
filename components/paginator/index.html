<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Paginator</title>
<script src="../../our.js"></script>
<script src="../../scripts/framework.js"></script>
<script src="../../src/components/paginator.js"></script>
<style>
#log { width: 100px; height: 30px; margin: 20px auto 0; color: orangered; font-weight: bold; font-size: 20px; text-align: center; }
#paginator { margin: 10px auto 100px; font-size: 12px; line-height: 14px; text-align: center; }
#paginator a { display: inline-block; margin: 2px; padding: 2px 5px; border: 1px solid silver; background: gainsboro; color: black; text-decoration: none; }
#paginator a.prev,
#paginator a.next { padding: 2px 10px; }
#paginator a:link,
#paginator a:visited,
#paginator a:active { background: gainsboro; }
#paginator a:hover { background: whitesmoke; }
#paginator a.current,
#paginator a.current:hover { background: white; }
#paginator a.disabled { border-color: gainsboro; background: whitesmoke; color: gainsboro; }
</style>
</head>
<body>
<div id="content">
  <h1>分页导航条</h1>

  <h2>Paginator</h2>
  <fieldset>
    <legend>分页导航条</legend>
    <form id="switch_mode">
      <label><input id="client" name="mode" type="radio" value="client" checked>客户端翻页（使用 Ajax 处理信息）</label><br>
      <label><input id="server" name="mode" type="radio" value="server">服务端翻页</label>
    </form>
    <div id="log"></div>
    <div id="paginator">
      <a href="javascript:void('prev');" title="上一页" class="prev">‹</a>
      <span></span>
      <a href="javascript:void('next');" title="下一页" class="next">›</a>
    </div>
  </fieldset>
  <script>
  execute(function($) {
    // TODO: 基于数据的行为管理。
    var $form = $('#switch_mode');
    var mode = localStorage.getItem('component_paginator_mode') || 'client';
    var saveMode = function() {
      mode = $form.getFieldValue('mode').getFirst();
      localStorage.setItem('component_paginator_mode', mode);
    };
    $('#' + mode).checked = true;
    $('#client').on('change', saveMode);
    $('#server').on('change', saveMode);

//--------------------------------------------------[paginator]
    var $paginator = $('#paginator');
    var controls = $paginator.find('a');
    var $pages = $paginator.find('span').getFirst();
    var totalRows = 500;
    var pageSize = 10;
    var totalPage = Math.ceil(totalRows / pageSize);
    var currentPage = Math.limit(parseInt(location.parameters.page, 10) || 1, 1, totalPage);
    window.paginator = new Paginator({
      prev: controls[0],
      next: controls[1],
      pages: $pages
    })
        .on('turn', function(e) {
          $('#log').morph({}, {
            duration: 500,
            onStart: function() {
              this.innerText = 'Loading...';
            },
            onFinish: function() {
              if (mode === 'client') {
                this.highlight().innerText = e.number;
                paginator.render(e.number, totalPage);
              } else {
                location.search = 'page=' + e.number;
              }
            }
          });
        })
        .on('render', function(e) {
        })
        .render(currentPage, totalPage);
  });
  </script>

</div>
</body>
</html>
